<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Book a Service - Diamond Finish Detailing</title>
  <meta name="description" content="Book your car detailing service with Diamond Finish Detailing. Choose from our premium packages and reserve your time slot.">
  <link rel="icon" href="/images/DFD.jpg" type="image/jpeg">
  <link rel="stylesheet" href="/styles/styles.css">
</head>
<body>
<!-- Navigation -->
<nav class="navbar">
  <div class="container">
    <a href="/" class="nav-brand">
      <img src="/images/DFD.jpg" alt="Diamond Finish Detailing" class="nav-logo">
      <span>Diamond Finish Detailing</span>
    </a>
    <div class="nav-tabs">
      <a href="/" class="nav-tab active">Detailing</a>
      <a href="/landscaping" class="nav-tab">Landscaping</a>
    </div>
  </div>
</nav>

<!-- Main Content -->
<main class="booking-page">
  <!-- Services Section -->
  <section class="section services-section">
    <div class="container">
      <div class="section-header">
        <h1 class="section-title">Our Services</h1>
        <div class="title-underline"></div>
        <p class="section-description">
          We offer a range of packages with base services and premium additives to protect and enhance every area of your vehicle.
        </p>
      </div>

      <div class="services-grid">
        <div class="service-card">
          <div class="service-badge">Essential</div>
          <h2 class="service-title">Level 1</h2>
          <div class="service-price">$75</div>
          <ul class="service-features">
            <li>✓ Exterior wash & wax</li>
            <li>✓ Interior deep cleaning</li>
            <li>✓ Tire shine</li>
            <li>✓ Window cleaning</li>
          </ul>
        </div>

        <div class="service-card featured">
          <div class="service-badge premium">Premium</div>
          <h2 class="service-title">Level 2</h2>
          <div class="service-price">$150</div>
          <div class="service-subtitle">Everything in Level 1, plus:</div>
          <ul class="service-features">
            <li>✓ Carpet shampoo</li>
            <li>✓ Scent removal</li>
            <li>✓ Ceramic coating</li>
            <li>✓ Exterior deep clean</li>
            <li>✓ Engine bay cleaning</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Booking Section -->
  <section class="section booking-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Book Your Appointment</h2>
        <div class="title-underline"></div>
        <p class="section-description">
          Select an available time slot below and complete your reservation. Click reserved slots to view or cancel.
        </p>
      </div>

      <div id="schedule-wrapper">
        <h3 class="schedule-title">Weekly Schedule (Mon–Fri)</h3>

        <div class="schedule-container">
          <div id="schedule-grid" class="schedule-grid" role="table">
            <div class="grid-row grid-header">
              <div class="grid-cell grid-time-col">Time</div>
              <div class="grid-cell">Monday</div>
              <div class="grid-cell">Tuesday</div>
              <div class="grid-cell">Wednesday</div>
              <div class="grid-cell">Thursday</div>
              <div class="grid-cell">Friday</div>
            </div>

            <!-- 4-6pm -->
            <div class="grid-row">
              <div class="grid-cell grid-time-col">4:00 - 6:00 PM</div>
              <div class="grid-cell"><div class="slot available" data-day="Monday" data-time="16-18">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Tuesday" data-time="16-18">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Wednesday" data-time="16-18">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Thursday" data-time="16-18">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Friday" data-time="16-18">Available</div></div>
            </div>

            <!-- 6-8pm -->
            <div class="grid-row">
              <div class="grid-cell grid-time-col">6:00 - 8:00 PM</div>
              <div class="grid-cell"><div class="slot available" data-day="Monday" data-time="18-20">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Tuesday" data-time="18-20">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Wednesday" data-time="18-20">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Thursday" data-time="18-20">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Friday" data-time="18-20">Available</div></div>
            </div>

            <!-- 8-10pm -->
            <div class="grid-row">
              <div class="grid-cell grid-time-col">8:00 - 10:00 PM</div>
              <div class="grid-cell"><div class="slot available" data-day="Monday" data-time="20-22">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Tuesday" data-time="20-22">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Wednesday" data-time="20-22">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Thursday" data-time="20-22">Available</div></div>
              <div class="grid-cell"><div class="slot available" data-day="Friday" data-time="20-22">Available</div></div>
            </div>
          </div>
        </div>

        <div class="legend">
          <strong>Legend:</strong>
          <span class="legend-item legend-available">Available</span>
          <span class="legend-item legend-reserved">Reserved</span>
        </div>

        <div class="schedule-actions">
          <button id="clearAll" class="btn btn-danger">Clear All Reservations</button>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <p>&copy; <span id="year">2025</span> Diamond Finish Detailing. All rights reserved.</p>
  </div>
</footer>

<!-- Custom Modal -->
<div id="customModal" class="modal-overlay">
  <div class="modal-content">
    <h3 id="modalTitle" class="modal-title"></h3>
    <p id="modalMessage" class="modal-message"></p>
    <input type="text" id="modalInput" class="modal-input" style="display: none;">
    <div class="modal-buttons">
      <button id="modalConfirm" class="btn btn-primary">OK</button>
      <button id="modalCancel" class="btn btn-outline" style="display: none;">Cancel</button>
    </div>
  </div>
</div>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  const STORAGE_KEY = 'reservations_v1';

  // Custom Modal Functions
  function showModal(title, message, type = 'alert', inputPlaceholder = '') {
    return new Promise((resolve) => {
      const modal = document.getElementById('customModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalMessage = document.getElementById('modalMessage');
      const modalInput = document.getElementById('modalInput');
      const confirmBtn = document.getElementById('modalConfirm');
      const cancelBtn = document.getElementById('modalCancel');

      modalTitle.textContent = title;
      modalMessage.textContent = message;

      if (type === 'prompt') {
        modalInput.style.display = 'block';
        modalInput.value = '';
        modalInput.placeholder = inputPlaceholder;
        cancelBtn.style.display = 'inline-block';
        confirmBtn.textContent = 'Submit';
      } else if (type === 'confirm') {
        modalInput.style.display = 'none';
        cancelBtn.style.display = 'inline-block';
        confirmBtn.textContent = 'Yes';
        cancelBtn.textContent = 'No';
      } else {
        modalInput.style.display = 'none';
        cancelBtn.style.display = 'none';
        confirmBtn.textContent = 'OK';
      }

      modal.classList.add('active');

      const handleConfirm = () => {
        modal.classList.remove('active');
        confirmBtn.removeEventListener('click', handleConfirm);
        cancelBtn.removeEventListener('click', handleCancel);
        if (type === 'prompt') {
          resolve(modalInput.value.trim());
        } else if (type === 'confirm') {
          resolve(true);
        } else {
          resolve(true);
        }
      };

      const handleCancel = () => {
        modal.classList.remove('active');
        confirmBtn.removeEventListener('click', handleConfirm);
        cancelBtn.removeEventListener('click', handleCancel);
        if (type === 'prompt') {
          resolve(null);
        } else {
          resolve(false);
        }
      };

      confirmBtn.addEventListener('click', handleConfirm);
      cancelBtn.addEventListener('click', handleCancel);

      if (type === 'prompt') {
        setTimeout(() => modalInput.focus(), 100);
      }
    });
  }

  function loadReservations(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : {};
    } catch (e){
      console.error('Failed to load reservations', e);
      return {};
    }
  }

  function saveReservations(obj){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
    } catch (e){
      console.error('Failed to save', e);
    }
  }

  const reservations = loadReservations();

  function slotKey(day, time){
    return day + '|' + time;
  }

  function render(){
    const slots = document.querySelectorAll('.slot');
    slots.forEach(function(cell){
      const day = cell.dataset.day;
      const time = cell.dataset.time;
      const key = slotKey(day, time);
      const r = reservations[key];
      const human = humanTimeLabel(time);

      if (r){
        cell.classList.remove('available');
        cell.classList.add('reserved');
        cell.innerHTML = '<div class="slot-time">' + human + '</div><div class="slot-status"><strong>Reserved</strong><br><small>' + escapeHtml(r.name) + '</small></div>';
      } else {
        cell.classList.remove('reserved');
        cell.classList.add('available');
        cell.innerHTML = '<div class="slot-time">' + human + '</div><div class="slot-status">Available</div>';
      }
    });
  }

  function humanTimeLabel(time){
    switch(time){
      case '16-18': return '4:00 - 6:00 PM';
      case '18-20': return '6:00 - 8:00 PM';
      case '20-22': return '8:00 - 10:00 PM';
      default: return time;
    }
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, function(ch){
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch];
    });
  }

  function validatePhone(phone){
    if (!phone) return false;
    const digits = phone.replace(/\D/g, '');
    if (digits.length < 7 || digits.length > 15) return false;
    const re = /^[+]?[(]?[0-9]{1,4}[)]?[-\s./0-9]*$/;
    return re.test(phone);
  }

  function validatePackage(pkg){
    if (!pkg) return false;
    const normalized = pkg.trim().toLowerCase().replace(/\s+/g, ' ');
    return normalized === 'level 1' || normalized === 'level 2';
  }

  function validateName(name){
    if (!name) return false;
    const t = name.trim();
    if (t.length < 2 || t.length > 50) return false;
    const re = /^[A-Za-z][A-Za-z' -]{0,48}[A-Za-z]$/;
    return re.test(t);
  }

  document.addEventListener('DOMContentLoaded', function(){
    render();

    document.querySelectorAll('.slot').forEach(function(cell){
      cell.addEventListener('click', async function(){
        const day = this.dataset.day;
        const time = this.dataset.time;
        const key = slotKey(day, time);
        const existing = reservations[key];

        if (existing){
          const action = await showModal(
                  'Reservation Details',
                  `Reserved by: ${existing.name}\nPhone: ${existing.phone}\nPackage: ${existing.package}\n\nType 'cancel' to cancel this reservation.`,
                  'prompt',
                  'Type "cancel" to cancel'
          );
          if (action && action.toLowerCase() === 'cancel'){
            const confirmed = await showModal(
                    'Confirm Cancellation',
                    'Are you sure you want to cancel this reservation?',
                    'confirm'
            );
            if (confirmed){
              delete reservations[key];
              saveReservations(reservations);
              render();
              await showModal('Success', 'Reservation cancelled successfully.');
            }
          }
        } else {
          let name = null;
          for (let attempts = 0; attempts < 3; attempts++){
            const n = await showModal(
                    'Enter Your Name',
                    'Please enter your full name (letters, spaces, hyphens, apostrophes):',
                    'prompt',
                    'John Doe'
            );
            if (!n){
              await showModal('Cancelled', 'Reservation cancelled - name is required.');
              break;
            }
            if (validateName(n)) { name = n.trim(); break; }
            await showModal('Invalid Name', 'Name not valid. Use letters, spaces, hyphens or apostrophes (2-50 chars).');
          }
          if (!name) return;

          let phone = null;
          for (let attempts = 0; attempts < 3; attempts++){
            const p = await showModal(
                    'Enter Phone Number',
                    'Please enter your phone number:',
                    'prompt',
                    '(317) 555-0123'
            );
            if (!p){
              await showModal('Cancelled', 'Reservation cancelled - phone is required.');
              break;
            }
            if (validatePhone(p)) { phone = p.trim(); break; }
            await showModal('Invalid Phone', 'Phone number not valid. Please enter a valid phone (7-15 digits).');
          }
          if (!phone) return;

          let pkg = null;
          for (let attempts = 0; attempts < 3; attempts++){
            const q = await showModal(
                    'Select Package',
                    'Please enter your desired package:',
                    'prompt',
                    'Level 1 or Level 2'
            );
            if (!q){
              await showModal('Cancelled', 'Reservation cancelled - package is required.');
              break;
            }
            if (validatePackage(q)) { pkg = q.trim(); break; }
            await showModal('Invalid Package', 'Package not recognized. Please enter "Level 1" or "Level 2".');
          }
          if (!pkg) return;

          reservations[key] = {
            name: name.trim(),
            phone: phone,
            package: pkg.trim(),
            created: Date.now()
          };
          saveReservations(reservations);
          render();
          await showModal('Success!', 'Reservation confirmed for ' + name + ' on ' + day + ' (' + humanTimeLabel(time) + ').');
        }
      });
    });

    document.getElementById('clearAll').addEventListener('click', async function(){
      const confirmed = await showModal(
              'Clear All Reservations',
              'Clear all reservations? This cannot be undone.',
              'confirm'
      );
      if (confirmed){
        for (const k in reservations) delete reservations[k];
        saveReservations(reservations);
        render();
        await showModal('Success', 'All reservations cleared.');
      }
    });
  });
</script>
</body>
</html>